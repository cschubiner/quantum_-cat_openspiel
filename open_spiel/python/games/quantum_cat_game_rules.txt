# CAT IN THE BOX
## A Quantum Trick-Taking Game for 2-5 Players

### GAME OVERVIEW
Cat in the Box is a trick-taking game where cards exist in a quantum state - having no fixed color until they're played. Players must carefully manage their color declarations while avoiding paradoxes and trying to win their predicted number of tricks. Through clever play and strategic color declarations, players attempt to create connected patterns on the research board while meeting their trick predictions.

### COMPONENTS

1. Research Board:
- A central grid showing numbers (rows) and colors (columns)
- Colors are: Red (Trump), Blue, Yellow, and Green
- Numbers vary by player count:
  - 5 Players: Numbers 1-9
  - 4 Players: Numbers 1-8
  - 3 Players: Numbers 1-6

2. Player Boards:
- Individual boards for each player
- Shows four color X spaces (one for each color)
- Displays available trick prediction values (1-4)
- Color-coded edges matching the research board colors

3. Cat Cards:
- Numbered cards with no inherent color
- 5 copies of each number in play
- Total cards vary by player count:
  - 5 Players: 45 cards (5 copies each of 1-9)
  - 4 Players: 40 cards (5 copies each of 1-8)
  - 3 Players: 30 cards (5 copies each of 1-6)

4. Player Tokens:
- 12 tokens per player in distinct colors
- Used to mark:
  - Available colors on player boards
  - Played cards on research board
  - Trick predictions

5. Start Player Card

### DETAILED SETUP

1. Research Board Setup:
- Place the research board in the center
- Ensure all spaces are clear
- The board shows:
  - Vertical columns for each color (Red, Blue, Yellow, Green)
  - Horizontal rows for each number in play
  - Red column marked with cat symbol (indicating Trump)

2. Player Setup:
- Each player receives:
  - One player board
  - 12 tokens in their color
  - Place one token on each X space of their board
  - These tokens indicate which colors you can still declare

3. Deck Preparation:
- Remove unused number cards based on player count
- Ensure exactly 5 copies of each valid number
- Shuffle thoroughly

### GAME STRUCTURE

The game plays out in three distinct phases:
1. Preparation Phase
2. Trick-Taking Phase
3. Scoring Phase

## PREPARATION PHASE

### 1. Card Distribution
- Deal cards equally to all players
- Players should keep their cards hidden
- All players will receive the same number of cards

### 2. Discard Phase
- Each player secretly selects one card from their hand
- Cards are placed face-down in the center
- These cards are removed from play for the entire round
- This reduces hand size by one before predictions

### 3. Prediction Phase
- Players examine their remaining cards
- Choose to predict winning 1, 2, 3, or 4 tricks
- Cannot predict 0 or more than 4 tricks
- Mark prediction with a token
- Consider:
  - High numbers are stronger
  - Red (Trump) is strongest color
  - Available color declarations
  - Potential for connected groups

## TRICK-TAKING PHASE

### Basic Mechanics

1. Playing Cards:
- Start player leads any card except red (unless red is broken)
- Must declare a valid color for the card
- Place card by appropriate color on player board
- Mark research board with token in matching space

2. Color Declaration Rules:
A color declaration is only valid if:
- The space on research board is empty
- You still have token on that color's X space
- It follows lead color/trump restrictions
- The number-color combination hasn't been claimed

3. Following Suit:
When responding to a led card, players have two options:
a) Follow the led color:
   - Declare your card as the led color
   - Place token on research board
   - Keep your color token on player board

b) Choose different color:
   - Declare any other valid color
   - MUST remove token from led color's X space
   - Can never declare that color again this round
   - Usually loses trick unless playing red (Trump)

### Trump (Red) Rules

1. Basic Trump Rules:
- Red is always trump
- Trump cards beat any non-trump card
- Cannot lead with red until "broken"

2. Breaking Trump:
- Occurs when player who can't follow suit plays red
- Once broken, red can be led
- Exception: Can lead red if it's your only color option

3. Trump Priority:
- Highest red card wins trick
- Red wins against any other color
- Multiple red cards: highest wins

### Winning Tricks

1. Determining Winner:
- Highest number of led color wins unless trump played
- If trump played, highest trump wins
- Cards of other colors cannot win

2. Collecting Tricks:
- Winner collects all cards face-down
- Keep tricks separate and visible
- Important for final scoring
- Track number of tricks vs prediction

### PARADOX RULES

A paradox occurs when a player cannot legally play any card because:

1. Trigger Conditions:
- All possible color/number combinations for their cards are taken
- They have no legal colors remaining to declare
- Must prove no legal play exists

2. Paradox Effects:
- Round ends immediately
- Paradox player loses 1 point per trick won
- Cannot earn bonus points
- Other players score normally

3. Avoiding Paradox:
- Carefully manage color declarations
- Watch research board spaces
- Consider keeping color options open
- Plan ahead for late-round plays

### RESEARCH BOARD STRATEGY

1. Token Placement:
- Tokens should be placed immediately when declaring
- Cannot be moved once placed
- Try to create connected groups
- Consider both horizontal and vertical connections

2. Connected Groups:
- Must be orthogonally adjacent (no diagonals)
- Larger groups = more bonus points
- Only count if prediction matched exactly
- Plan placement carefully

3. Strategic Considerations:
- Balance between winning tricks and creating groups
- Watch opponents' patterns
- Block potential connections
- Keep track of available spaces

## SCORING PHASE

### Regular Scoring

1. Trick Points:
- One point per trick won
- Applies even if prediction not met
- Exception: Paradox penalties

2. Paradox Penalties:
- Lose one point per trick won
- No bonus points possible
- Example: 3 tricks won = -3 points

### Bonus Scoring

Only awarded if:
1. Exactly matched prediction AND
2. Did not cause paradox

Calculation:
1. Find largest group of connected tokens
2. Count orthogonally connected tokens
3. Score one point per token
4. Multiple groups: only largest counts

Example:
```
Research Board Pattern:
R B Y G
1 ■ □ ■ □
2 ■ ■ □ □
3 □ ■ □ □
4 □ □ □ □

■ = Player's tokens
Largest connected group = 4 tokens
Bonus score = 4 points
```

### GAME END CONDITIONS

The round (and game) ends when either:
1. Each player has one card remaining in hand
   - Do not play final cards
   - Proceed directly to scoring
OR
2. A paradox occurs
   - Immediate end
   - Score as described above

### TWO-PLAYER VARIANT

Special Rules:
1. Components:
   - Use only numbers 1-5
   - 5 copies of each number
   - Deal 10 cards per player

2. Setup:
   - Reveal 3 cards from remainder
   - Block those numbers in green
   - Remove those cards from play

3. Gameplay Changes:
   - No predictions made
   - Must win 4 or fewer tricks for bonus
   - Otherwise, same rules apply

### CRITICAL REMINDERS

1. Mandatory Actions:
- Must play if able
- Cannot pass
- Must declare a color when playing

2. Color Declaration:
- Once removed, color cannot be "rediscovered"
- Each number exists once per color
- Must be valid on both boards

3. Trick Management:
- Keep tricks visible
- Count carefully
- Affects final scoring

4. Research Board:
- Cannot move tokens once placed
- Plan connections carefully
- Watch for blocking moves

---------

4 things to keep in mind: 
"""One, there is no pass action. If it's your turn, whether it's in the prediction phase or the trick-taking phase, if it's your move, you have to play an action. And if there are no moves you can make, and you're in the trick-taking phase, then you have to paradox. So maybe paradox should be implemented as a move. Or, in the trick-taking phase, we could do it where if the player has no legal moves, then that would be considered a paradox. I'm not sure what's best. You can decide. 

The second thing that needs to change is that you're misinterpreting the rule of the instructions mentioning placing one card face-down to move from play. This is actually something that happens after the Dealing phase, but before the Bid Prediction phase. Basically, each player looks at their full hand and decides to discard one of their cards face-down into the center. Those cards are removed from play, which means if there are five players, then five cards will be removed from play. 

Ah, and a third thing... Let's say each player starts with nine cards. They will discard one to get down to eight. But then the number of tricks they play is only seven, so you never actually end up playing all... all of the cards that start off in your hand, because the game ends with every player having one card in their hand still remaining. 

Finally, when you create the deck, let's say it's five players. You don't create a deck of nine cards times four, but rather you create a deck of nine cards times five. Similarly, when there are four players, you remove the nines, so you'll have a deck of cards one through eight, and five of each of them. And then with three players, there are no eights or nines, so you'll have the cards one through seven, and there will be five of each as well.
"""

PARADOX PENALTY: The penalty for paradox is that you cannot get the bonus connecting points even if you made the exact amount of tricks that you bid. And the second penalty is that your score, instead of being equal to the number of tricks you bid, it's actually equal to negative one times that number. Meaning you get penalized more for paradoxing the more tricks you made.


BONUS SCORING: This is adjacency scoring. You only get this adjacency bonus if you predicted the number of tricks correctly. And if you did it in Paradox. We don't need to implement multiple rounds. This whole game should just be one round, as we have existing. Also, you can only ever bid a number between one and four tricks. You can't bid zero or any number greater than four. Given this, please write out the new full implementation including any additional observer logic
